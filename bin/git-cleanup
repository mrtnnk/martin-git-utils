#!/usr/bin/env ruby

# Deletes (almost) every branch already merged into current branch.
# Exceptions are `master`, `staging`, and `development`, and the current
# branch, which are preserved. We also support custom configuration via the
# `~/.git-cleanup-preserved` file.
preserved = "master|staging|development"
preserved_file = File.join(Dir.home, '.git-cleanup-preserved')
if File.exist?(preserved_file)
  additional_preserved = File.read(preserved_file).strip.split("\n")
  unless additional_preserved.empty?
    preserved += '|' + additional_preserved.join('|')
  end
end
cmd  = %(git branch --merged | grep -v "\*" | egrep -v "(#{preserved})" | )
cmd += 'xargs -n 1 git branch -d'
system cmd
